# SPDX-FileCopyrightText: Fondazione Istituto Italiano di Tecnologia (IIT)
# SPDX-License-Identifier: BSD-3-Clause


set(MSG_HEADERS)
set(MSG_SOURCES)
set(MSG_INCLUDE_DIRS)

function(trintrin_add_idl idl_file)
    yarp_idl_to_dir(
        INPUT_FILES ${idl_file}
        OUTPUT_DIR ${CMAKE_CURRENT_BINARY_DIR}/autogenerated
        SOURCES_VAR AUTOGENERATE_SRC
        HEADERS_VAR AUTOGENERATE_HDR
        INCLUDE_DIRS_VAR AUTOGENERATE_INCLUDE_DIRS
        VERBOSE)

    set(MSG_HEADERS ${MSG_HEADERS} ${AUTOGENERATE_HDR} PARENT_SCOPE)
    set(MSG_SOURCES ${MSG_SOURCES} ${AUTOGENERATE_SRC} PARENT_SCOPE)
    set(MSG_INCLUDE_DIRS ${MSG_INCLUDE_DIRS} ${AUTOGENERATE_INCLUDE_DIRS} PARENT_SCOPE)
endfunction()

trintrin_add_idl(trintrin/msgs/Common.thrift)
trintrin_add_idl(trintrin/msgs/HumanDynamics.thrift)
trintrin_add_idl(trintrin/msgs/HumanState.thrift)
trintrin_add_idl(trintrin/msgs/HumanWrench.thrift)
trintrin_add_idl(trintrin/msgs/WearableActuators.thrift)
trintrin_add_idl(trintrin/msgs/WearableData.thrift)
trintrin_add_idl(trintrin/msgs/WearableTargets.thrift)


add_library(trintrin_msgs
            ${MSG_HEADERS}
            ${MSG_SOURCES})

add_library(trintrin::msgs ALIAS trintrin_msgs)
target_link_libraries(trintrin_msgs YARP::YARP_os)
set_target_properties(trintrin_msgs PROPERTIES
                      PUBLIC_HEADER "${MSG_HEADERS}")
foreach(dir ${MSG_INCLUDE_DIRS})
    target_include_directories(trintrin_msgs PUBLIC $<BUILD_INTERFACE:${dir}>)
endforeach()
target_include_directories(trintrin_msgs PUBLIC
                           $<INSTALL_INTERFACE:${CMAKE_INSTALL_INCLUDEDIR}/trintrin/msgs>)

install(TARGETS trintrin_msgs
        EXPORT trintrin
        RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
        ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}
        LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
        PUBLIC_HEADER DESTINATION "${CMAKE_INSTALL_INCLUDEDIR}/trintrin/msgs")
